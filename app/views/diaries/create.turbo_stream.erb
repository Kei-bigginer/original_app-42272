<%# ================================ %>
<%# ğŸ“¸ æˆåŠŸæ™‚ï¼šæ—¥å¸¸æŠ•ç¨¿ä¸€è¦§ã‚’æœ€æ–°çŠ¶æ…‹ã«æ›´æ–° %>
<%# ================================ %>
<% if @diaries.present? %>
  <turbo-stream target="diary-list" action="replace">
    <template>
      <%# âœ… æŠ•ç¨¿ä¸€è¦§éƒ¨åˆ†ï¼ˆæœ€æ–°çŠ¶æ…‹ï¼‰ã‚’ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«ã§å·®ã—æ›¿ãˆ %>
      <%== render partial: "diaries/diary_list", formats: [:html], locals: { diaries: @diaries } %>
    </template>
  </turbo-stream>

  <turbo-stream action="append" target="modal-script-placeholder">
    <template>
      <script>
        // âœ… Turboã§æç”»ç›´å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€å®‰å®šã®ãŸã‚ã«å°‘ã—é…ã‚‰ã›ã¦å®Ÿè¡Œ
        setTimeout(() => {
          // âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—ã—ã¦é–‰ã˜ã‚‹
          let modal = bootstrap.Modal.getInstance(document.getElementById("diaryModal"));
          if (modal) modal.hide();

          // âœ… ãƒ•ã‚©ãƒ¼ãƒ ã‚’å–å¾—ã—ã¦ãƒªã‚»ãƒƒãƒˆï¼ˆç”»åƒé¸æŠãªã©ã‚’ã‚¯ãƒªã‚¢ï¼‰
          let form = document.querySelector("#diaryModal form");
          if (form) form.reset();
        }, 10); // â† 10ãƒŸãƒªç§’å¾…æ©Ÿã§Turboæç”»ã¨ã®ç«¶åˆã‚’å›é¿
      </script>
    </template>
  </turbo-stream>

<%# ================================ %>
<%# âŒ å¤±æ•—æ™‚ï¼šãƒ¢ãƒ¼ãƒ€ãƒ«å†…ãƒ•ã‚©ãƒ¼ãƒ ã®ã¿ã‚’å·®ã—æ›¿ãˆï¼ˆã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼‰ %>
<%# ================================ %>
<% else %>
  <turbo-stream target="diaryModal-body" action="replace">
    <template>
      <%# â— ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼æ™‚ï¼šãƒ•ã‚©ãƒ¼ãƒ ã‚’å†æç”»ã—ã¦ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º %>
      <%= render partial: "diaries/form", locals: { diary: @diary } %>
    </template>
  </turbo-stream>
<% end %>
